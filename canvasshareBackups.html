<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <img src="./images/timg.jpg" id="daiyan_bg" alt="">
    <canvas id="myCanvas"></canvas>
</body>
</html>
<script>
    var pointMsg = "飞鱼的狂喷" //$(".pointtxt").val(),     
        daiyanMsg = "想要的踊跃" //$(".daiyan_msg").html(); 
    var imgbox = document.getElementById("daiyan_bg"),
        canvas = document.getElementById("myCanvas");
    var ctx = canvas.getContext("2d"); //getContext("2d") 对象是内建的 HTML5 对象，拥有多种绘制路径、矩形、圆形、字符以及添加图像的方法。
    canvas.width = 750;            
    var imgUrl = new Image,
        qrCodeUrl = new Image,
        point = new Image;
    // imgUrl.crossOrigin = "anonymous";
    imgUrl.src = imgbox.src;
    qrCodeUrl.src = "./images/code_03.jpg";
    // point.src = "./images/head02.png";
    point.src = "./images/head02.jpg";
    var daiyan_text = "我要代颜";            
    var btm = document.getElementById("bottom");                
    imgUrl.onload = function () {
        canvas.height = this.height + 50;
        ctx.fillStyle = "#fff"; //填充颜色
        ctx.fillRect(0, 0, 750, 1334); //绘制"被填充"的矩形
        var erWeiMaY = this.height - qrCodeUrl.height - 70;
        var wyDyY = this.height - 57;
        if (ctx.drawImage(imgUrl, 0, 0, 750, this.height), 
            ctx.beginPath(), 
            ctx.font = "normal 24px PingFangSC-Medium", 
            ctx.textAlign = "start", 
            ctx.textBaseline = "hanging",
            // ctx.shadowOffsetX = 0, //设置或返回阴影与形状的水平距离
            // ctx.shadowOffsetY = 5, //设置或返回阴影与形状的垂直距离
            // ctx.shadowColor = "rgba(0, 0, 0, 0.3)", //设置或返回用于阴影的颜色
            // ctx.shadowBlur = 5, //设置或返回用于阴影的模糊级别 
            "" != pointMsg && void 0 != pointMsg && null != pointMsg) {
            var pTxt = "我在：" + pointMsg;
            ctx.fillText(pTxt, 95, 5 * 2 + 55);
            ctx.save();
            ctx.arc(63,88,23,0,Math.PI*2,true);
            ctx.clip();
            ctx.createPattern(point,"no-repeat");
            ctx.drawImage(point,40,65, 46, 46);//按指定大小绘制 所要绘制的图像 xy坐标 宽高
            ctx.restore();
        }

        ctx.beginPath();
        ctx.drawImage(qrCodeUrl, 0, 0, 140, 140, 570, erWeiMaY, 140, 140);
        // ctx.drawImage(btm, 0, 0, 750, 50, 0, this.height, 750, 50);

        if (ctx.beginPath(), ctx.font = "normal 18px PingFangSC-Medium") {
            ctx.fillText(daiyan_text, 595, wyDyY);
            ctx.fillStyle = "#cc0000";
        }
    // ![](http://images2017.cnblogs.com/blog/688074/201709/688074-20170930143321965-1499864646.jpg)


        if (ctx.beginPath(), ctx.font = "normal 24px PingFangSC-Medium", ctx.shadowOffsetX = 0, ctx.shadowOffsetY = 5, ctx.shadowColor = "rgba(0, 0, 0, 0.3)", ctx.shadowBlur = 5) {
            ctx.fillText(daiyanMsg, 95, 5 * 2 + 130);
        }

        // document.getElementById("daiyan_bg1").src = canvas.toDataURL('image/jpeg');

        // $(".page2").hide().siblings(".page3").show();

        // $.post(url, { base64_string: canvas.toDataURL('image/jpeg') }, function (res) { }, "json");    //记录用户生成的海报信息

        // var tipTop = this.height / 4 - 47;
        // $(".save_tip").show().css("top", tipTop);
        // setTimeout(function () {
        //     $(".save_tip").hide();
        // }, 3000);               
    };
</script>